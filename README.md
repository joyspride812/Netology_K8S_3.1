
# Netology_K8S_3.1 Моисеенко А.Н. 
## Домашнее задание к занятию «Компоненты Kubernetes»
### Цель задания
Рассчитать требования к кластеру под проект


### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

Необходимо упаковать приложение в чарт для деплоя в разные окружения.
База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.  

## Расчет потребления ресурсов.

### База данных (StatefulSet) 3 копии, отказоустойчивая:

- 4 ГБ RAM x 3 = 12 ГБ
- 1 CPU x 3 = 3 CPU


### Кеш (StatefulSet) 3 копии, отказоустойчивый:

- 4 ГБ RAM x 3 = 12 ГБ
- 1 CPU x 3 = 3 CPU

### Фронтенд (5 копий)
50 МБ RAM x 5 = 0.25 ГБ
0,2 CPU x 5 = 1 CPU

### Бекенд (10 копий)
600 МБ RAM x 10= 6 ГБ
1 CPU x 10 = 10 CPU


## Общий расчёт ресурсов приложения
### RAM
- БД         12 Гб
- Кеш        12 Гб
- Фронтенд   0,25 ГБ
- Бекенд     6 ГБ
- Итого      ~ 31 Гб.

### CPU
- БД         3
- Кеш        3
- Фронтенд   1
- Бекенд     10
- Итого      17 CPU

Системные ресурсы Kubernetes
На каждой ноде работают: kubelet, container runtime, ОС, системные DaemonSet
Обычно закладывают: + 15-20 % на системные нужды.



## Запас на выход из строя одной ноды
Требование - кластер должен пережить отказ минимум одной ноды.
Значит при падении одной ноды остальные должны иметь возможность развернуть PODы c упавшей.



### Подбор характеристик и кол-ва worker нод
Выбран размер ноды 8 CPU / 32 ГБ RAM как оптимальный баланс между количеством нод и плотностью размещения. Меньшие ноды увеличивают их общее число и усложняют управление, а более крупные приводят к избыточному резервированию ресурсов. Конфигурация обеспечивает устойчивость к выходу из строя одной ноды и оставляет резерв по CPU.


Общая нагрузка 31 ГБ RAM / 32 ГБ RAM. Получается большой запас по RAm но 16 Гб может быть недостаточно,так как k8s не перераспределяет нагрузку вручную и идеально.
Общая нагрузка 17 CPU /8 CPU ноды = 2,125 . Следовательно требуется минимум 3 ноды + 1 для отказоустойчивости.

### Оптимальный вариант для worker нод
4 Ноды по 8 CPU/32 ГБ

### Control Plane
Для обеспечения HA control plane необходимо использовать миниму 3 ноды.
Рекомендуется 3 ноды по:
4 ГБ RAM
2 CPU 

